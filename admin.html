<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç®¡ç†ç”»é¢ | æ•°å­¦ä¸­1</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root { --red:#e8372a; --dark:#1a1a2e; --mid:#16213e; --accent:#f5a623; --green:#2ecc71; --text:#e8e8f0; --muted:#8888aa; }
  * { box-sizing:border-box; margin:0; padding:0; }
  body { font-family:'Noto Sans JP',sans-serif; background:var(--dark); color:var(--text); min-height:100vh; }

  /* ===== ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ ===== */
  .login-screen {
    min-height: 100vh; display: flex; align-items: center; justify-content: center;
    background: linear-gradient(135deg, #0d0d1e 0%, #16213e 100%);
  }
  .login-box {
    background: var(--mid); border: 2px solid #2a2a4a; border-radius: 16px;
    padding: 40px; width: 360px; text-align: center;
  }
  .login-icon { font-size: 40px; margin-bottom: 16px; }
  .login-box h1 { font-size: 20px; font-weight: 900; margin-bottom: 8px; }
  .login-box p { font-size: 13px; color: var(--muted); margin-bottom: 28px; }
  .pw-input {
    width: 100%; background: #0a0a20; border: 2px solid #3a3a5a; border-radius: 8px;
    color: white; font-size: 16px; padding: 12px 16px; outline: none; margin-bottom: 16px;
    transition: border-color 0.2s; letter-spacing: 4px; text-align: center;
  }
  .pw-input:focus { border-color: var(--accent); }
  .pw-input.error { border-color: var(--red); animation: shake 0.3s; }
  @keyframes shake { 0%,100%{transform:translateX(0)} 25%{transform:translateX(-6px)} 75%{transform:translateX(6px)} }
  .login-btn {
    width: 100%; background: var(--red); color: white; border: none; border-radius: 8px;
    padding: 12px; font-size: 15px; font-weight: 700; cursor: pointer; transition: background 0.2s;
  }
  .login-btn:hover { background: #c0392b; }
  .error-msg { font-size: 13px; color: var(--red); margin-top: 10px; min-height: 18px; }

  /* ===== ç®¡ç†ç”»é¢ ===== */
  .admin-screen { display: none; }
  header {
    background: var(--mid); border-bottom: 3px solid var(--red);
    padding: 14px 20px; display: flex; align-items: center; gap: 12px; position: sticky; top: 0; z-index: 100;
  }
  .admin-badge { background: var(--accent); color: #1a1a2e; font-family:'Space Mono',monospace; font-size:10px; font-weight:700; padding:3px 8px; border-radius:4px; }
  header h1 { font-size: 16px; font-weight: 900; flex: 1; }
  .logout-btn {
    background: #2a2a4a; border: none; color: var(--muted); padding: 6px 14px;
    border-radius: 6px; font-size: 13px; cursor: pointer; transition: background 0.2s;
  }
  .logout-btn:hover { background: var(--red); color: white; }
  .back-link { color: var(--muted); text-decoration: none; font-size: 14px; }
  .back-link:hover { color: var(--text); }

  .container { max-width: 960px; margin: 0 auto; padding: 28px 20px 80px; }

  /* Unit selector */
  .unit-selector { margin-bottom: 28px; }
  .unit-selector label { display: block; font-size: 13px; color: var(--muted); margin-bottom: 8px; font-family:'Space Mono',monospace; letter-spacing:1px; }
  .unit-select {
    width: 100%; background: #0f1a30; border: 2px solid #3a3a5a; border-radius: 8px;
    color: white; font-size: 15px; padding: 10px 14px; outline: none; cursor: pointer;
    transition: border-color 0.2s;
  }
  .unit-select:focus { border-color: var(--accent); }

  /* Section card */
  .edit-card {
    background: var(--mid); border: 2px solid #2a2a4a; border-radius: 12px;
    padding: 22px; margin-bottom: 20px;
  }
  .edit-card-title {
    font-family:'Space Mono',monospace; font-size:11px; font-weight:700; letter-spacing:2px;
    color: var(--accent); margin-bottom: 16px; text-transform: uppercase;
  }

  /* Form elements */
  .form-group { margin-bottom: 14px; }
  .form-label { display: block; font-size: 12px; color: var(--muted); margin-bottom: 6px; }
  .form-input, .form-textarea {
    width: 100%; background: #0a0a20; border: 2px solid #3a3a5a; border-radius: 7px;
    color: white; font-family:'Noto Sans JP',sans-serif; font-size: 14px;
    padding: 9px 12px; outline: none; transition: border-color 0.2s; resize: vertical;
  }
  .form-input:focus, .form-textarea:focus { border-color: var(--accent); }

  /* Problem editor */
  .problem-editor {
    background: #0f1a30; border: 1px solid #2a2a4a; border-radius: 10px;
    padding: 16px; margin-bottom: 12px; position: relative;
  }
  .problem-editor-header {
    display: flex; align-items: center; gap: 10px; margin-bottom: 12px;
  }
  .prob-id-badge {
    background: #1a2a50; font-family:'Space Mono',monospace; font-size:10px;
    color: var(--muted); padding: 2px 8px; border-radius: 4px;
  }
  .delete-prob-btn {
    margin-left: auto; background: rgba(232,55,42,0.1); border: 1px solid rgba(232,55,42,0.3);
    color: var(--red); border-radius: 6px; padding: 4px 10px; font-size: 12px; cursor: pointer;
    transition: background 0.2s;
  }
  .delete-prob-btn:hover { background: rgba(232,55,42,0.25); }

  .choices-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 8px; }
  .choice-row { display: flex; align-items: center; gap: 6px; }
  .correct-radio { accent-color: var(--green); width: 16px; height: 16px; cursor: pointer; }
  .choice-label { font-size: 11px; color: var(--muted); min-width: 44px; font-family:'Space Mono',monospace; }

  .add-prob-btn {
    width: 100%; background: rgba(41,128,185,0.1); border: 2px dashed rgba(41,128,185,0.3);
    color: #2980b9; border-radius: 8px; padding: 12px; font-size: 14px; font-weight: 700;
    cursor: pointer; transition: background 0.2s, border-color 0.2s; margin-top: 4px;
  }
  .add-prob-btn:hover { background: rgba(41,128,185,0.2); border-color: rgba(41,128,185,0.5); }

  /* Save button */
  .save-bar {
    position: fixed; bottom: 0; left: 0; right: 0;
    background: var(--mid); border-top: 2px solid #2a2a4a;
    padding: 16px 24px; display: flex; align-items: center; justify-content: space-between; gap: 12px;
    z-index: 200;
  }
  .save-status { font-size: 13px; color: var(--muted); }
  .save-status.saved { color: var(--green); }
  .save-btn {
    background: var(--green); color: #1a1a2e; border: none; border-radius: 8px;
    padding: 12px 32px; font-size: 15px; font-weight: 900; cursor: pointer;
    transition: background 0.2s, transform 0.1s;
  }
  .save-btn:hover { background: #27ae60; transform: translateY(-1px); }
  .save-btn:active { transform: translateY(0); }

  /* Tabs */
  .tabs { display: flex; gap: 4px; margin-bottom: 16px; }
  .tab-btn {
    background: #0f1a30; border: 2px solid #2a2a4a; border-radius: 7px;
    color: var(--muted); padding: 7px 16px; font-size: 13px; font-weight: 700;
    cursor: pointer; transition: all 0.15s;
  }
  .tab-btn.active { background: var(--accent); border-color: var(--accent); color: #1a1a2e; }

  .tab-content { display: none; }
  .tab-content.active { display: block; }
</style>
</head>
<body>

<!-- ===== ãƒ­ã‚°ã‚¤ãƒ³ç”»é¢ ===== -->
<div class="login-screen" id="loginScreen">
  <div class="login-box">
    <div class="login-icon">ğŸ”</div>
    <h1>ç®¡ç†ç”»é¢</h1>
    <p>ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
    <input type="password" class="pw-input" id="pwInput" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" onkeydown="if(event.key==='Enter')tryLogin()">
    <button class="login-btn" onclick="tryLogin()">ãƒ­ã‚°ã‚¤ãƒ³</button>
    <div class="error-msg" id="errorMsg"></div>
  </div>
</div>

<!-- ===== ç®¡ç†ç”»é¢ ===== -->
<div class="admin-screen" id="adminScreen">
  <header>
    <span class="admin-badge">ADMIN</span>
    <h1>ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ç®¡ç†ç”»é¢</h1>
    <a class="back-link" href="index.html">â† ãƒˆãƒƒãƒ—ã¸æˆ»ã‚‹</a>
    <button class="logout-btn" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
  </header>

  <div class="container">

    <!-- å˜å…ƒé¸æŠ -->
    <div class="unit-selector">
      <label>UNIT SELECTOR â€” ç·¨é›†ã™ã‚‹å˜å…ƒã‚’é¸æŠ</label>
      <select class="unit-select" id="unitSelect" onchange="loadUnitEditor()">
      </select>
    </div>

    <!-- ã‚¿ãƒ– -->
    <div class="tabs">
      <button class="tab-btn active" onclick="switchTab('basic')">åŸºæœ¬æƒ…å ±</button>
      <button class="tab-btn" onclick="switchTab('point')">ãƒã‚¤ãƒ³ãƒˆè§£èª¬</button>
      <button class="tab-btn" onclick="switchTab('warmup')">Warm Up å•é¡Œ</button>
      <button class="tab-btn" onclick="switchTab('exercise')">Exercise å•é¡Œ</button>
    </div>

    <!-- åŸºæœ¬æƒ…å ±ã‚¿ãƒ– -->
    <div class="tab-content active" id="tab-basic">
      <div class="edit-card">
        <div class="edit-card-title">ğŸ“‹ åŸºæœ¬æƒ…å ±</div>
        <div class="form-group">
          <label class="form-label">å˜å…ƒIDï¼ˆå¤‰æ›´ä¸å¯ï¼‰</label>
          <input class="form-input" id="editId" disabled>
        </div>
        <div class="form-group">
          <label class="form-label">å˜å…ƒã‚¿ã‚¤ãƒˆãƒ«</label>
          <input class="form-input" id="editTitle" placeholder="ä¾‹ï¼šç§»é …ã®åŸºæœ¬ï¼ˆx+a=bï¼‰">
        </div>
        <div class="form-group">
          <label class="form-label">YouTube å‹•ç”»URLï¼ˆåŸ‹ã‚è¾¼ã¿URLï¼‰</label>
          <input class="form-input" id="editYoutube" placeholder="ä¾‹ï¼šhttps://www.youtube.com/embed/XXXXXXXXXXX">
          <div style="font-size:12px;color:var(--muted);margin-top:4px;">YouTubeã®ã€Œå…±æœ‰ â†’ åŸ‹ã‚è¾¼ã¿ã€ã‹ã‚‰src=ã®ä¸­ã®URLã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã ã•ã„</div>
        </div>
      </div>
    </div>

    <!-- ãƒã‚¤ãƒ³ãƒˆè§£èª¬ã‚¿ãƒ– -->
    <div class="tab-content" id="tab-point">
      <div class="edit-card">
        <div class="edit-card-title">ğŸ’¡ ãƒã‚¤ãƒ³ãƒˆè§£èª¬</div>
        <div class="form-group">
          <label class="form-label">ãƒã‚¤ãƒ³ãƒˆã‚¿ã‚¤ãƒˆãƒ«</label>
          <input class="form-input" id="editPointTitle" placeholder="ä¾‹ï¼šç§»é …ã®ãƒ«ãƒ¼ãƒ«">
        </div>
        <div class="form-group">
          <label class="form-label">è§£èª¬ãƒ†ã‚­ã‚¹ãƒˆï¼ˆHTMLã‚¿ã‚°ä½¿ç”¨å¯ï¼‰</label>
          <textarea class="form-textarea" id="editPointHtml" rows="10" placeholder="è§£èª¬å†…å®¹ã‚’å…¥åŠ›..."></textarea>
          <div style="font-size:12px;color:var(--muted);margin-top:4px;">
            &lt;strong&gt;å¤ªå­—&lt;/strong&gt;ã€&lt;span class="math-highlight"&gt;æ•°å¼&lt;/span&gt; ãªã©ãŒä½¿ãˆã¾ã™
          </div>
        </div>
      </div>
    </div>

    <!-- Warm Up ã‚¿ãƒ– -->
    <div class="tab-content" id="tab-warmup">
      <div class="edit-card">
        <div class="edit-card-title">ğŸ”µ Warm Up å•é¡Œï¼ˆåŸºæœ¬å•é¡Œï¼‰</div>
        <div id="warmupEditor"></div>
        <button class="add-prob-btn" onclick="addProblem('warmup')">ï¼‹ å•é¡Œã‚’è¿½åŠ </button>
      </div>
    </div>

    <!-- Exercise ã‚¿ãƒ– -->
    <div class="tab-content" id="tab-exercise">
      <div class="edit-card">
        <div class="edit-card-title">ğŸŸ¢ Exercise å•é¡Œï¼ˆç·´ç¿’å•é¡Œï¼‰</div>
        <div id="exerciseEditor"></div>
        <button class="add-prob-btn" onclick="addProblem('exercise')">ï¼‹ å•é¡Œã‚’è¿½åŠ </button>
      </div>
    </div>

  </div>

  <!-- ä¿å­˜ãƒãƒ¼ -->
  <div class="save-bar">
    <span class="save-status" id="saveStatus">ç·¨é›†ä¸­...</span>
    <button class="save-btn" onclick="saveUnit()">ğŸ’¾ ä¿å­˜ã™ã‚‹</button>
  </div>
</div>

<script src="data_ch1.js"></script>
<script>
// ===== ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¨­å®šï¼ˆã“ã“ã‚’å¤‰æ›´ã—ã¦ãã ã•ã„ï¼‰ =====
const ADMIN_PASSWORD = "juku2024";
// ===================================================

let currentData = null;
let unitIdx = 0;

// --- ãƒ­ã‚°ã‚¤ãƒ³ ---
function tryLogin() {
  const pw = document.getElementById('pwInput').value;
  const input = document.getElementById('pwInput');
  const err = document.getElementById('errorMsg');
  if (pw === ADMIN_PASSWORD) {
    document.getElementById('loginScreen').style.display = 'none';
    document.getElementById('adminScreen').style.display = 'block';
    initAdmin();
  } else {
    input.classList.add('error');
    err.textContent = 'ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™';
    setTimeout(() => input.classList.remove('error'), 400);
  }
}

function logout() {
  document.getElementById('loginScreen').style.display = 'flex';
  document.getElementById('adminScreen').style.display = 'none';
  document.getElementById('pwInput').value = '';
}

// --- åˆæœŸåŒ– ---
function initAdmin() {
  const sel = document.getElementById('unitSelect');
  sel.innerHTML = '';
  CHAPTER1_UNITS.forEach((u, i) => {
    const opt = document.createElement('option');
    opt.value = i;
    opt.textContent = `${u.id} ${u.title}`;
    sel.appendChild(opt);
  });
  loadUnitEditor();
}

// --- å˜å…ƒãƒ­ãƒ¼ãƒ‰ ---
function loadUnitEditor() {
  unitIdx = parseInt(document.getElementById('unitSelect').value);
  // ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ‡ã‚£ãƒ¼ãƒ—ã‚³ãƒ”ãƒ¼
  currentData = JSON.parse(JSON.stringify(CHAPTER1_UNITS[unitIdx]));

  document.getElementById('editId').value = currentData.id;
  document.getElementById('editTitle').value = currentData.title;
  document.getElementById('editYoutube').value = currentData.youtube || '';
  document.getElementById('editPointTitle').value = currentData.point.title;
  document.getElementById('editPointHtml').value = currentData.point.html;

  renderProblemEditor('warmup');
  renderProblemEditor('exercise');
  setSaveStatus('ç·¨é›†ä¸­...');
}

// --- å•é¡Œã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼æç”» ---
function renderProblemEditor(type) {
  const container = document.getElementById(`${type}Editor`);
  container.innerHTML = '';
  const problems = currentData[type];
  problems.forEach((p, i) => {
    container.appendChild(makeProblemEditor(type, i, p));
  });
}

function makeProblemEditor(type, i, p) {
  const div = document.createElement('div');
  div.className = 'problem-editor';
  div.dataset.type = type;
  div.dataset.idx = i;

  const prefix = type === 'warmup' ? 'WU' : 'EX';
  const choicesHtml = (p.choices || ['','','','']).map((c, ci) => `
    <div class="choice-row">
      <label class="choice-label">é¸æŠè‚¢ ${ci+1}</label>
      <input type="radio" class="correct-radio" name="correct_${type}_${i}" value="${ci}"
        ${String(p.answer) === String(c) ? 'checked' : ''} onchange="updateCorrect('${type}',${i},this)">
      <input class="form-input" style="flex:1" value="${c}"
        placeholder="é¸æŠè‚¢ã‚’å…¥åŠ›" oninput="updateChoice('${type}',${i},${ci},this.value)">
    </div>`).join('');

  div.innerHTML = `
    <div class="problem-editor-header">
      <span class="prob-id-badge">${prefix}-${i+1}</span>
      <button class="delete-prob-btn" onclick="deleteProblem('${type}',${i})">ğŸ—‘ å‰Šé™¤</button>
    </div>
    <div class="form-group">
      <label class="form-label">å•é¡Œæ–‡</label>
      <input class="form-input" value="${p.expr.replace(/"/g,'&quot;')}" placeholder="å•é¡Œæ–‡ã‚’å…¥åŠ›"
        oninput="updateField('${type}',${i},'expr',this.value)">
    </div>
    <div class="form-group">
      <label class="form-label">é¸æŠè‚¢ï¼ˆæ­£è§£ã®ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã‚’é¸ã‚“ã§ãã ã•ã„ï¼‰</label>
      <div class="choices-grid">${choicesHtml}</div>
    </div>
    <div class="form-group">
      <label class="form-label">ãƒ’ãƒ³ãƒˆ</label>
      <input class="form-input" value="${p.hint.replace(/"/g,'&quot;')}" placeholder="ãƒ’ãƒ³ãƒˆã‚’å…¥åŠ›"
        oninput="updateField('${type}',${i},'hint',this.value)">
    </div>`;
  return div;
}

// --- æ›´æ–°é–¢æ•° ---
function updateField(type, idx, field, val) {
  currentData[type][idx][field] = val;
  setSaveStatus('æœªä¿å­˜ã®å¤‰æ›´ãŒã‚ã‚Šã¾ã™');
}

function updateChoice(type, idx, choiceIdx, val) {
  const old = currentData[type][idx].choices[choiceIdx];
  currentData[type][idx].choices[choiceIdx] = val;
  // æ­£è§£ã‚‚åŒã˜å€¤ãªã‚‰æ›´æ–°
  if (String(currentData[type][idx].answer) === String(old)) {
    currentData[type][idx].answer = val;
  }
  setSaveStatus('æœªä¿å­˜ã®å¤‰æ›´ãŒã‚ã‚Šã¾ã™');
}

function updateCorrect(type, idx, radio) {
  const choiceIdx = parseInt(radio.value);
  currentData[type][idx].answer = currentData[type][idx].choices[choiceIdx];
  setSaveStatus('æœªä¿å­˜ã®å¤‰æ›´ãŒã‚ã‚Šã¾ã™');
}

function addProblem(type) {
  const prefix = type === 'warmup' ? 'WU' : 'EX';
  const newP = {
    id: `${prefix}-${currentData[type].length + 1}`,
    expr: '',
    answer: '',
    choices: ['', '', '', ''],
    hint: ''
  };
  currentData[type].push(newP);
  const container = document.getElementById(`${type}Editor`);
  container.appendChild(makeProblemEditor(type, currentData[type].length - 1, newP));
  setSaveStatus('æœªä¿å­˜ã®å¤‰æ›´ãŒã‚ã‚Šã¾ã™');
}

function deleteProblem(type, idx) {
  if (!confirm('ã“ã®å•é¡Œã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ')) return;
  currentData[type].splice(idx, 1);
  renderProblemEditor(type);
  setSaveStatus('æœªä¿å­˜ã®å¤‰æ›´ãŒã‚ã‚Šã¾ã™');
}

// --- ä¿å­˜ ---
function saveUnit() {
  // å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‹ã‚‰æœ€æ–°å€¤ã‚’å–å¾—
  currentData.title = document.getElementById('editTitle').value;
  currentData.youtube = document.getElementById('editYoutube').value;
  currentData.point.title = document.getElementById('editPointTitle').value;
  currentData.point.html = document.getElementById('editPointHtml').value;

  // ãƒ¡ãƒ¢ãƒªä¸Šã®ãƒ‡ãƒ¼ã‚¿ã‚’æ›´æ–°
  CHAPTER1_UNITS[unitIdx] = JSON.parse(JSON.stringify(currentData));

  // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç”¨ã®JSãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆ
  const jsContent = generateDataJS();
  const blob = new Blob([jsContent], { type: 'text/javascript' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'data_ch1.js';
  a.click();
  URL.revokeObjectURL(url);

  setSaveStatus('âœ… ä¿å­˜ã—ã¾ã—ãŸï¼ˆdata_ch1.js ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦å·®ã—æ›¿ãˆã¦ãã ã•ã„ï¼‰', true);
}

function generateDataJS() {
  return `// =============================================
// æ•°å­¦ä¸­1 ç¬¬1ç«  æ­£è² ã®æ•° - å…¨å˜å…ƒãƒ‡ãƒ¼ã‚¿
// æœ€çµ‚æ›´æ–°ï¼š${new Date().toLocaleString('ja-JP')}
// =============================================
const CHAPTER1_UNITS = ${JSON.stringify(CHAPTER1_UNITS, null, 2)};
`;
}

function setSaveStatus(msg, saved=false) {
  const el = document.getElementById('saveStatus');
  el.textContent = msg;
  el.className = 'save-status' + (saved ? ' saved' : '');
}

// --- ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ ---
function switchTab(name) {
  document.querySelectorAll('.tab-btn').forEach((b,i) => {
    const names = ['basic','point','warmup','exercise'];
    b.classList.toggle('active', names[i] === name);
  });
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  document.getElementById(`tab-${name}`).classList.add('active');
}

// Enterã§ãƒ­ã‚°ã‚¤ãƒ³
document.getElementById('pwInput').addEventListener('keydown', e => {
  if (e.key === 'Enter') tryLogin();
});
</script>
</body>
</html>
